<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LHopper - Knight Move Puzzle Game</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        .header {
            background: #000;
            margin: -40px -40px 30px -40px;
            padding: 30px 40px;
            border-radius: 20px 20px 0 0;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-squares {
            display: grid;
            grid-template-columns: 20px 20px;
            grid-template-rows: 20px 20px;
            gap: 3px;
        }

        .logo-squares .square {
            background: white;
            border-radius: 3px;
        }

        .logo-squares .square:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
        }

        .logo-squares .square:nth-child(2) {
            grid-column: 1;
            grid-row: 2;
        }

        .logo-squares .square:nth-child(3) {
            grid-column: 2;
            grid-row: 2;
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin: 0;
        }

        .tagline {
            color: white;
            font-size: 1.1em;
            text-align: center;
            margin: 0;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .mode-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .grid-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .grid-btn {
            padding: 10px 18px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .grid-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .grid-btn.active {
            background: #667eea;
            color: white;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
        }

        .game-board {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .grid {
            display: inline-grid;
            gap: 8px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .cell {
            width: 70px;
            height: 70px;
            border: 3px solid #ddd;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        /* Dynamic sizing for larger grids */
        .grid[style*="repeat(6"] .cell {
            width: 60px;
            height: 60px;
            font-size: 1.5em;
        }

        .grid[style*="repeat(7"] .cell {
            width: 52px;
            height: 52px;
            font-size: 1.3em;
        }

        .grid[style*="repeat(8"] .cell {
            width: 46px;
            height: 46px;
            font-size: 1.2em;
        }

        .grid[style*="repeat(9"] .cell {
            width: 42px;
            height: 42px;
            font-size: 1.1em;
        }

        .cell:hover:not(.filled) {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .cell.filled {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: default;
            border-color: #667eea;
        }

        .cell.last {
            animation: pulse 1s infinite;
        }

        .cell.valid-move {
            border-color: #4caf50;
            background: #e8f5e9;
            animation: highlight 1.5s infinite;
        }

        @keyframes highlight {
            0%, 100% { 
                border-color: #4caf50;
                box-shadow: 0 0 0 rgba(76, 175, 80, 0.4);
            }
            50% { 
                border-color: #66bb6a;
                box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .message.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .message.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .message.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .how-to-play {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .how-to-play h3 {
            text-align: center;
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .instruction-item {
            margin-bottom: 15px;
            line-height: 1.6;
            color: #333;
        }

        .instruction-item:last-child {
            margin-bottom: 0;
        }

        .instruction-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            .header {
                margin: -20px -20px 20px -20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tagline {
                font-size: 0.95em;
            }

            .logo-squares {
                grid-template-columns: 16px 16px;
                grid-template-rows: 16px 16px;
                gap: 2px;
            }

            .cell {
                width: 50px;
                height: 50px;
                font-size: 1.4em;
            }

            .grid[style*="repeat(6"] .cell {
                width: 44px;
                height: 44px;
                font-size: 1.2em;
            }

            .grid[style*="repeat(7"] .cell {
                width: 38px;
                height: 38px;
                font-size: 1.1em;
            }

            .grid[style*="repeat(8"] .cell {
                width: 34px;
                height: 34px;
                font-size: 1em;
            }

            .grid[style*="repeat(9"] .cell {
                width: 30px;
                height: 30px;
                font-size: 0.9em;
            }

            .mode-btn {
                padding: 10px 20px;
                font-size: 1em;
            }

            .grid-btn {
                padding: 8px 14px;
                font-size: 0.85em;
            }

            .how-to-play h3 {
                font-size: 1.3em;
            }

            .instructions {
                padding: 15px;
            }

            .instruction-item {
                font-size: 0.95em;
                margin-bottom: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function KnightsPathGame() {
            const [gridSize, setGridSize] = useState(5);
            const [grid, setGrid] = useState([]);
            const [currentNumber, setCurrentNumber] = useState(1);
            const [gameStarted, setGameStarted] = useState(false);
            const [gameOver, setGameOver] = useState(false);
            const [gameWon, setGameWon] = useState(false);
            const [lastPosition, setLastPosition] = useState(null);
            const [highScore, setHighScore] = useState({ 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 });
            const [moveHistory, setMoveHistory] = useState([]);
            const [mode, setMode] = useState('friendly'); // 'friendly' or 'challenging'

            useEffect(() => {
                initializeGrid();
            }, [gridSize]);

            const initializeGrid = () => {
                const newGrid = Array(gridSize).fill(null).map(() => 
                    Array(gridSize).fill(null)
                );
                setGrid(newGrid);
                setCurrentNumber(1);
                setGameStarted(false);
                setGameOver(false);
                setGameWon(false);
                setLastPosition(null);
                setMoveHistory([]);
            };

            const isValidKnightMove = (fromRow, fromCol, toRow, toCol) => {
                const rowDiff = Math.abs(toRow - fromRow);
                const colDiff = Math.abs(toCol - fromCol);
                return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);
            };

            const getValidMoves = (row, col, gridToCheck = null) => {
                const moves = [];
                const knightMoves = [
                    [-2, -1], [-2, 1], [-1, -2], [-1, 2],
                    [1, -2], [1, 2], [2, -1], [2, 1]
                ];

                const checkGrid = gridToCheck || grid;

                for (let [dr, dc] of knightMoves) {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    if (newRow >= 0 && newRow < gridSize && 
                        newCol >= 0 && newCol < gridSize && 
                        checkGrid[newRow][newCol] === null) {
                        moves.push([newRow, newCol]);
                    }
                }
                return moves;
            };

            const isValidMove = (row, col) => {
                if (mode !== 'friendly') return false;
                if (!gameStarted || gameOver || gameWon) return false;
                if (grid[row][col] !== null) return false;
                if (currentNumber === 1) return true;
                if (!lastPosition) return false;
                
                const validMoves = getValidMoves(lastPosition[0], lastPosition[1]);
                return validMoves.some(([r, c]) => r === row && c === col);
            };

            const handleCellClick = (row, col) => {
                if (gameOver || gameWon) return;
                if (grid[row][col] !== null) return;

                // First move - can click anywhere
                if (currentNumber === 1) {
                    const newGrid = grid.map(r => [...r]);
                    newGrid[row][col] = 1;
                    setGrid(newGrid);
                    setCurrentNumber(2);
                    setGameStarted(true);
                    setLastPosition([row, col]);
                    setMoveHistory([{ grid: grid.map(r => [...r]), number: 1, position: null }]);
                    
                    // Check if there are any valid moves after first placement
                    // IMPORTANT: Check against newGrid, not grid (which hasn't updated yet)
                    const validMoves = getValidMoves(row, col, newGrid);
                    if (validMoves.length === 0) {
                        setGameOver(true);
                        updateHighScore(1);
                    }
                    return;
                }

                // Subsequent moves - must be valid knight move
                if (lastPosition && isValidKnightMove(lastPosition[0], lastPosition[1], row, col)) {
                    const newGrid = grid.map(r => [...r]);
                    newGrid[row][col] = currentNumber;
                    
                    // Save state before making move
                    setMoveHistory([...moveHistory, { 
                        grid: grid.map(r => [...r]), 
                        number: currentNumber, 
                        position: lastPosition 
                    }]);
                    
                    setGrid(newGrid);
                    setLastPosition([row, col]);
                    
                    const nextNumber = currentNumber + 1;
                    setCurrentNumber(nextNumber);

                    // Check if game is won
                    if (nextNumber > gridSize * gridSize) {
                        setGameWon(true);
                        updateHighScore(gridSize * gridSize);
                        return;
                    }

                    // Check if there are any valid moves left
                    // IMPORTANT: Check against newGrid, not grid (which hasn't updated yet)
                    const validMoves = getValidMoves(row, col, newGrid);
                    if (validMoves.length === 0) {
                        setGameOver(true);
                        updateHighScore(currentNumber);
                    }
                }
            };

            const handleUndo = () => {
                if (moveHistory.length === 0) return;
                
                const previousState = moveHistory[moveHistory.length - 1];
                setGrid(previousState.grid);
                setCurrentNumber(previousState.number);
                setLastPosition(previousState.position);
                setMoveHistory(moveHistory.slice(0, -1));
                setGameOver(false);
                setGameWon(false);
                
                if (previousState.number === 1) {
                    setGameStarted(false);
                    setLastPosition(null);
                }
            };

            const updateHighScore = (score) => {
                setHighScore(prev => ({
                    ...prev,
                    [gridSize]: Math.max(prev[gridSize], score)
                }));
            };

            const resetGame = () => {
                initializeGrid();
            };

            const changeGridSize = (size) => {
                setGridSize(size);
            };

            const toggleMode = () => {
                setMode(mode === 'friendly' ? 'challenging' : 'friendly');
            };

            const getMessage = () => {
                if (gameWon) {
                    return { text: 'ðŸŽ‰ Congratulations! You filled the entire grid!', type: 'success' };
                }
                if (gameOver) {
                    return { text: `Game Over! You reached ${currentNumber - 1}. No valid moves remaining.`, type: 'error' };
                }
                if (!gameStarted) {
                    return { text: 'Click any square to place number 1 and start the game!', type: 'info' };
                }
                return { text: `Place number ${currentNumber} using a knight's move (L-shape)`, type: 'info' };
            };

            const message = getMessage();

            return (
                <div className="game-container">
                    <div className="header">
                        <div className="logo">
                            <div className="logo-squares">
                                <div className="square"></div>
                                <div className="square"></div>
                                <div className="square"></div>
                            </div>
                            <h1>LHopper</h1>
                        </div>
                        <p className="tagline">Fill the grid using knight moves!</p>
                    </div>

                    <div className="controls">
                        <div className="mode-selector">
                            <button 
                                className={`mode-btn ${mode === 'friendly' ? 'active' : ''}`}
                                onClick={() => setMode('friendly')}
                            >
                                ðŸ˜Š Friendly
                            </button>
                            <button 
                                className={`mode-btn ${mode === 'challenging' ? 'active' : ''}`}
                                onClick={() => setMode('challenging')}
                            >
                                ðŸ’ª Challenging
                            </button>
                        </div>
                        
                        <div className="grid-selector">
                            {[3, 4, 5, 6, 7, 8, 9].map(size => (
                                <button 
                                    key={size}
                                    className={`grid-btn ${gridSize === size ? 'active' : ''}`}
                                    onClick={() => changeGridSize(size)}
                                >
                                    {size}Ã—{size}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="stats">
                        <div className="stat">
                            <div className="stat-label">Current Score</div>
                            <div className="stat-value">{currentNumber - 1}</div>
                        </div>
                        <div className="stat">
                            <div className="stat-label">High Score ({gridSize}Ã—{gridSize})</div>
                            <div className="stat-value">{highScore[gridSize]}</div>
                        </div>
                    </div>

                    <div className={`message ${message.type}`}>
                        {message.text}
                    </div>

                    <div className="game-board">
                        <div 
                            className="grid" 
                            style={{ 
                                gridTemplateColumns: `repeat(${gridSize}, 1fr)`,
                                gridTemplateRows: `repeat(${gridSize}, 1fr)`
                            }}
                        >
                            {grid.map((row, rowIndex) => 
                                row.map((cell, colIndex) => (
                                    <div
                                        key={`${rowIndex}-${colIndex}`}
                                        className={`cell ${cell !== null ? 'filled' : ''} ${
                                            lastPosition && lastPosition[0] === rowIndex && lastPosition[1] === colIndex ? 'last' : ''
                                        } ${isValidMove(rowIndex, colIndex) ? 'valid-move' : ''}`}
                                        onClick={() => handleCellClick(rowIndex, colIndex)}
                                    >
                                        {cell}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    <div className="actions">
                        <button 
                            className="btn btn-secondary" 
                            onClick={handleUndo}
                            disabled={moveHistory.length === 0}
                        >
                            â†¶ Undo
                        </button>
                        <button className="btn btn-primary" onClick={resetGame}>
                            New Game
                        </button>
                    </div>

                    <div className="how-to-play">
                        <h3>How to Play</h3>
                        <div className="instructions">
                            <div className="instruction-item">
                                <strong>ðŸŽ¯ Objective:</strong> Fill the entire grid with numbers in sequence (1, 2, 3...) by moving like a knight in chess.
                            </div>
                            <div className="instruction-item">
                                <strong>â™ž Knight Move:</strong> Move in an L-shape - 2 squares in one direction, then 1 square perpendicular. Click any square to start with "1", then click valid squares to continue.
                            </div>
                            <div className="instruction-item">
                                <strong>ðŸ˜Š Friendly Mode:</strong> Valid moves are highlighted in green to help you learn the pattern.
                            </div>
                            <div className="instruction-item">
                                <strong>ðŸ’ª Challenging Mode:</strong> No hints - test your memory and strategy!
                            </div>
                            <div className="instruction-item">
                                <strong>ðŸŽ² Grid Sizes:</strong> Start with 3Ã—3 for practice, then try larger grids for a tougher challenge. 3Ã—3 and 4Ã—4 grids are mathematically impossible to complete, you'll always be left with at least one square. 5Ã—5 and larger grids can be fully solved, but it's going to be challenging! Try different starting squares, aim for solving the grid and try to beat your highest score. Good luck!
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<KnightsPathGame />, document.getElementById('root'));
    </script>
</body>
</html>
